/**
 * Country data with flags and dial codes for phone verification
 */

export const countries = [
    {
        name: "United States",
        code: "US",
        dialCode: "+1",
        flag: "ðŸ‡ºðŸ‡¸",
        format: "(###) ###-####"
    },
    {
        name: "United Kingdom", 
        code: "GB",
        dialCode: "+44",
        flag: "ðŸ‡¬ðŸ‡§",
        format: "#### ### ####"
    },
    {
        name: "Canada",
        code: "CA", 
        dialCode: "+1",
        flag: "ðŸ‡¨ðŸ‡¦",
        format: "(###) ###-####"
    },
    {
        name: "Australia",
        code: "AU",
        dialCode: "+61", 
        flag: "ðŸ‡¦ðŸ‡º",
        format: "#### ### ###"
    },
    {
        name: "Germany",
        code: "DE",
        dialCode: "+49",
        flag: "ðŸ‡©ðŸ‡ª", 
        format: "### ### ####"
    },
    {
        name: "France",
        code: "FR",
        dialCode: "+33",
        flag: "ðŸ‡«ðŸ‡·",
        format: "## ## ## ## ##"
    },
    {
        name: "Italy",
        code: "IT",
        dialCode: "+39",
        flag: "ðŸ‡®ðŸ‡¹",
        format: "### ### ####"
    },
    {
        name: "Spain",
        code: "ES",
        dialCode: "+34",
        flag: "ðŸ‡ªðŸ‡¸",
        format: "### ### ###"
    },
    {
        name: "Netherlands",
        code: "NL",
        dialCode: "+31",
        flag: "ðŸ‡³ðŸ‡±",
        format: "## ### ####"
    },
    {
        name: "Belgium",
        code: "BE",
        dialCode: "+32",
        flag: "ðŸ‡§ðŸ‡ª",
        format: "### ### ###"
    },
    {
        name: "Switzerland",
        code: "CH",
        dialCode: "+41",
        flag: "ðŸ‡¨ðŸ‡­",
        format: "## ### ## ##"
    },
    {
        name: "Austria",
        code: "AT",
        dialCode: "+43",
        flag: "ðŸ‡¦ðŸ‡¹",
        format: "### ### ####"
    },
    {
        name: "Sweden",
        code: "SE",
        dialCode: "+46",
        flag: "ðŸ‡¸ðŸ‡ª",
        format: "## ### ## ##"
    },
    {
        name: "Norway",
        code: "NO",
        dialCode: "+47",
        flag: "ðŸ‡³ðŸ‡´",
        format: "### ## ###"
    },
    {
        name: "Denmark",
        code: "DK",
        dialCode: "+45",
        flag: "ðŸ‡©ðŸ‡°",
        format: "## ## ## ##"
    },
    {
        name: "Finland",
        code: "FI",
        dialCode: "+358",
        flag: "ðŸ‡«ðŸ‡®",
        format: "## ### ####"
    },
    {
        name: "Poland",
        code: "PL",
        dialCode: "+48",
        flag: "ðŸ‡µðŸ‡±",
        format: "### ### ###"
    },
    {
        name: "Czech Republic",
        code: "CZ",
        dialCode: "+420",
        flag: "ðŸ‡¨ðŸ‡¿",
        format: "### ### ###"
    },
    {
        name: "Hungary",
        code: "HU",
        dialCode: "+36",
        flag: "ðŸ‡­ðŸ‡º",
        format: "## ### ####"
    },
    {
        name: "Portugal",
        code: "PT",
        dialCode: "+351",
        flag: "ðŸ‡µðŸ‡¹",
        format: "### ### ###"
    },
    {
        name: "Greece",
        code: "GR",
        dialCode: "+30",
        flag: "ðŸ‡¬ðŸ‡·",
        format: "### ### ####"
    },
    {
        name: "Turkey",
        code: "TR",
        dialCode: "+90",
        flag: "ðŸ‡¹ðŸ‡·",
        format: "### ### ## ##"
    },
    {
        name: "Russia",
        code: "RU",
        dialCode: "+7",
        flag: "ðŸ‡·ðŸ‡º",
        format: "### ###-##-##"
    },
    {
        name: "India",
        code: "IN",
        dialCode: "+91",
        flag: "ðŸ‡®ðŸ‡³",
        format: "##### #####"
    },
    {
        name: "China",
        code: "CN",
        dialCode: "+86",
        flag: "ðŸ‡¨ðŸ‡³",
        format: "### #### ####"
    },
    {
        name: "Japan",
        code: "JP",
        dialCode: "+81",
        flag: "ðŸ‡¯ðŸ‡µ",
        format: "##-####-####"
    },
    {
        name: "South Korea",
        code: "KR",
        dialCode: "+82",
        flag: "ðŸ‡°ðŸ‡·",
        format: "##-####-####"
    },
    {
        name: "Singapore",
        code: "SG",
        dialCode: "+65",
        flag: "ðŸ‡¸ðŸ‡¬",
        format: "#### ####"
    },
    {
        name: "Malaysia",
        code: "MY",
        dialCode: "+60",
        flag: "ðŸ‡²ðŸ‡¾",
        format: "##-### ####"
    },
    {
        name: "Thailand",
        code: "TH",
        dialCode: "+66",
        flag: "ðŸ‡¹ðŸ‡­",
        format: "##-###-####"
    },
    {
        name: "Philippines",
        code: "PH",
        dialCode: "+63",
        flag: "ðŸ‡µðŸ‡­",
        format: "### ### ####"
    },
    {
        name: "Indonesia",
        code: "ID",
        dialCode: "+62",
        flag: "ðŸ‡®ðŸ‡©",
        format: "###-###-####"
    },
    {
        name: "Vietnam",
        code: "VN",
        dialCode: "+84",
        flag: "ðŸ‡»ðŸ‡³",
        format: "### ### ####"
    },
    {
        name: "Brazil",
        code: "BR",
        dialCode: "+55",
        flag: "ðŸ‡§ðŸ‡·",
        format: "## #####-####"
    },
    {
        name: "Argentina",
        code: "AR",
        dialCode: "+54",
        flag: "ðŸ‡¦ðŸ‡·",
        format: "## ####-####"
    },
    {
        name: "Mexico",
        code: "MX",
        dialCode: "+52",
        flag: "ðŸ‡²ðŸ‡½",
        format: "## #### ####"
    },
    {
        name: "Colombia",
        code: "CO",
        dialCode: "+57",
        flag: "ðŸ‡¨ðŸ‡´",
        format: "### ### ####"
    },
    {
        name: "Chile",
        code: "CL",
        dialCode: "+56",
        flag: "ðŸ‡¨ðŸ‡±",
        format: "# #### ####"
    },
    {
        name: "Peru",
        code: "PE",
        dialCode: "+51",
        flag: "ðŸ‡µðŸ‡ª",
        format: "### ### ###"
    },
    {
        name: "Uruguay",
        code: "UY",
        dialCode: "+598",
        flag: "ðŸ‡ºðŸ‡¾",
        format: "## ### ###"
    },
    {
        name: "South Africa",
        code: "ZA",
        dialCode: "+27",
        flag: "ðŸ‡¿ðŸ‡¦",
        format: "## ### ####"
    },
    {
        name: "Egypt",
        code: "EG",
        dialCode: "+20",
        flag: "ðŸ‡ªðŸ‡¬",
        format: "## #### ####"
    },
    {
        name: "Morocco",
        code: "MA",
        dialCode: "+212",
        flag: "ðŸ‡²ðŸ‡¦",
        format: "###-######"
    },
    {
        name: "Nigeria",
        code: "NG",
        dialCode: "+234",
        flag: "ðŸ‡³ðŸ‡¬",
        format: "### ### ####"
    },
    {
        name: "Kenya",
        code: "KE",
        dialCode: "+254",
        flag: "ðŸ‡°ðŸ‡ª",
        format: "### ######"
    },
    {
        name: "Ghana",
        code: "GH",
        dialCode: "+233",
        flag: "ðŸ‡¬ðŸ‡­",
        format: "## ### ####"
    },
    {
        name: "Israel",
        code: "IL",
        dialCode: "+972",
        flag: "ðŸ‡®ðŸ‡±",
        format: "##-###-####"
    },
    {
        name: "United Arab Emirates",
        code: "AE",
        dialCode: "+971",
        flag: "ðŸ‡¦ðŸ‡ª",
        format: "## ### ####"
    },
    {
        name: "Saudi Arabia",
        code: "SA",
        dialCode: "+966",
        flag: "ðŸ‡¸ðŸ‡¦",
        format: "## ### ####"
    },
    {
        name: "New Zealand",
        code: "NZ",
        dialCode: "+64",
        flag: "ðŸ‡³ðŸ‡¿",
        format: "##-###-####"
    }
];

/**
 * Get country by code
 */
export function getCountryByCode(code) {
    return countries.find(country => country.code === code);
}

/**
 * Get country by dial code
 */
export function getCountryByDialCode(dialCode) {
    return countries.find(country => country.dialCode === dialCode);
}

/**
 * Search countries by name
 */
export function searchCountries(query) {
    if (!query) return countries;
    
    const lowercaseQuery = query.toLowerCase();
    return countries.filter(country => 
        country.name.toLowerCase().includes(lowercaseQuery) ||
        country.code.toLowerCase().includes(lowercaseQuery) ||
        country.dialCode.includes(query)
    );
}

/**
 * Detect country by IP (using ipapi.co)
 */
export async function detectCountryByIP() {
    try {
        const response = await fetch('https://ipapi.co/json/', {
            method: 'GET',
            headers: { 'Accept': 'application/json' }
        });
        
        if (response.ok) {
            const data = await response.json();
            const country = getCountryByCode(data.country_code);
            if (country) {
                return country;
            }
        }
    } catch (error) {
        console.warn('IP detection failed:', error);
    }
    
    // Default to US if detection fails
    return getCountryByCode('US');
}

/**
 * Format phone number according to country format
 */
export function formatPhoneNumber(phoneNumber, country) {
    if (!phoneNumber || !country?.format) return phoneNumber;
    
    // Remove all non-digit characters
    const digits = phoneNumber.replace(/\D/g, '');
    
    // Apply the format
    let formatted = '';
    let digitIndex = 0;
    
    for (let i = 0; i < country.format.length && digitIndex < digits.length; i++) {
        if (country.format[i] === '#') {
            formatted += digits[digitIndex];
            digitIndex++;
        } else {
            formatted += country.format[i];
        }
    }
    
    return formatted;
}

/**
 * Validate phone number format
 */
export function validatePhoneNumber(phoneNumber, country) {
    if (!phoneNumber || !country) return false;
    
    // Remove all non-digit characters
    const digits = phoneNumber.replace(/\D/g, '');
    
    // Basic validation - should have reasonable length
    return digits.length >= 7 && digits.length <= 15;
}